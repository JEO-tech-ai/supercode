# SuperCode UI Enhancement Master Plan

> **Project**: SuperCode UI Feature Parity with OpenCode
> **Date**: 2026-01-14
> **Status**: Planning Phase
> **Generated by**: Multi-Agent Analysis (Sisyphus + Explore Agents)

---

## Executive Summary

이 문서는 SuperCode의 모든 UI 관련 기능을 OpenCode 수준으로 개선하기 위한 마스터 계획입니다. 
7개의 explore agent를 통한 심층 분석 결과를 바탕으로, 파일 추가, 마우스 클릭, 슬래시 명령 등 
모든 UI 기능의 구현 계획을 단계별로 정리했습니다.

---

## Current State Comparison

### Architecture Overview

| Aspect | SuperCode (AS-IS) | OpenCode (Reference) | Gap Analysis |
|--------|-------------------|----------------------|--------------|
| **TUI Framework** | React + Ink | SolidJS + @opentui | Different paradigms |
| **Web Console** | Dashboard only | Full Chat Interface | Major gap |
| **Input System** | Basic text input | Extmarks + Rich content | Significant gap |
| **Command System** | Client-side only | Server-side + MCP | Major gap |
| **File Handling** | Text references only | Binary upload + Preview | Major gap |
| **Keyboard** | Basic keybindings | Leader key + Chorded | Moderate gap |
| **Mouse** | SGR protocol support | Copy-on-select + Focus | Minor gap |

### Feature Gap Summary

```
                        SuperCode    OpenCode    Priority
                        ---------    --------    --------
Slash Commands          [====----]   [========]  HIGH
  - Client-side only    [X]
  - Server-side         [ ]          [X]
  - MCP Integration     [ ]          [X]
  - Subtask Delegation  [ ]          [X]

File Handling           [==------]   [========]  HIGH
  - Text references     [X]          [X]
  - Image paste         [ ]          [X]
  - Drag-and-drop       [ ]          [X]
  - Binary upload       [ ]          [X]
  - Preview system      [ ]          [X]

Keyboard/Mouse          [=====---]   [========]  MEDIUM
  - Basic keybinds      [X]          [X]
  - Leader key          [ ]          [X]
  - Copy-on-select      [ ]          [X]
  - Focus trapping      [ ]          [X]

Command Palette         [====----]   [========]  MEDIUM
  - Static commands     [X]          [X]
  - Dynamic registration [ ]         [X]
  - useFilteredList     [ ]          [X]
  - Unified dialog      [ ]          [X]

TUI Components          [=====---]   [========]  MEDIUM
  - Prompt input        [X]          [X]
  - Extmarks/Pills      [ ]          [X]
  - Toast system        [X]          [X]
  - Dialog system       [X]          [X]

Web Console             [=-------]   [========]  HIGH
  - Dashboard           [X]          [X]
  - Chat interface      [ ]          [X]
  - File tree           [ ]          [X]
  - Terminal embed      [ ]          [X]
```

---

## Implementation Phases

### Phase 1: Command System Overhaul (Priority: HIGH)
**Estimated Duration: 1 week**

OpenCode의 서버-사이드 명령 시스템을 SuperCode에 도입합니다.

| Task | Description | Complexity |
|------|-------------|------------|
| 1.1 | Server-side command registry | High |
| 1.2 | Positional arguments ($1, $2) | Medium |
| 1.3 | MCP command discovery | High |
| 1.4 | Subtask delegation to agents | High |
| 1.5 | Inline bash execution in templates | Medium |

**Key Files to Create/Modify:**
```
src/
├── command/
│   ├── registry.ts          # NEW: Server-side command registry
│   ├── template.ts          # NEW: Template expansion engine
│   ├── mcp-discovery.ts     # NEW: MCP prompt discovery
│   └── types.ts             # NEW: Command type definitions
├── session/
│   └── prompt.ts            # MODIFY: Command execution logic
└── server/routes/
    └── command.ts           # NEW: /session/:id/command endpoint
```

**Reference Implementation:**
- `opencode/packages/opencode/src/command/index.ts`
- `opencode/packages/opencode/src/session/prompt.ts`

---

### Phase 2: File Handling System (Priority: HIGH)
**Estimated Duration: 1.5 weeks**

OpenCode의 풍부한 파일 처리 기능을 구현합니다.

| Task | Description | Complexity |
|------|-------------|------------|
| 2.1 | Image paste handling (base64) | Medium |
| 2.2 | Drag-and-drop overlay UI | Medium |
| 2.3 | Binary file upload flow | High |
| 2.4 | Image preview component | Medium |
| 2.5 | PDF attachment support | Medium |
| 2.6 | File part schema (SDK) | Medium |

**Key Files to Create/Modify:**
```
src/tui/
├── component/prompt/
│   ├── MediaPaste.tsx       # NEW: Image/PDF paste handling
│   ├── DragDropOverlay.tsx  # NEW: Drag-drop visual feedback
│   └── ImagePreview.tsx     # NEW: Image preview component
├── hooks/
│   ├── useClipboard.ts      # NEW: Clipboard integration
│   └── useDragDrop.ts       # NEW: Drag-drop handler
└── context/
    └── file.tsx             # NEW: File attachment context

packages/console/app/src/
├── components/
│   ├── prompt-input.tsx     # NEW: Web console input
│   ├── dialog-select-file.tsx # NEW: File selection dialog
│   └── image-preview.tsx    # NEW: Image preview modal
└── context/
    └── file.tsx             # NEW: File state management
```

**Reference Implementation:**
- `opencode/packages/app/src/components/prompt-input.tsx` (lines 267-358)
- `opencode/packages/app/src/context/file.tsx`

---

### Phase 3: Mouse & Keyboard Interactions (Priority: MEDIUM)
**Estimated Duration: 1 week**

고급 키보드/마우스 인터랙션을 구현합니다.

| Task | Description | Complexity |
|------|-------------|------------|
| 3.1 | Leader key system (Vim-style) | High |
| 3.2 | Copy-on-select in TUI | Medium |
| 3.3 | Focus trap for dialogs | Medium |
| 3.4 | Focus restoration logic | Medium |
| 3.5 | Enhanced keybind registry | Medium |

**Key Files to Create/Modify:**
```
src/tui/
├── hooks/
│   ├── useLeaderKey.ts      # NEW: Leader key state machine
│   ├── useFocusTrap.ts      # NEW: Dialog focus trap
│   └── useMouse.ts          # MODIFY: Add copy-on-select
├── context/
│   └── keybind.tsx          # MODIFY: Leader key integration
└── component/
    └── Border.tsx           # MODIFY: Focus indicator styling
```

**Reference Implementation:**
- `opencode/packages/opencode/src/cli/cmd/tui/context/keybind.tsx`
- `opencode/packages/app/src/context/command.tsx`

---

### Phase 4: Command Palette & Keybindings (Priority: MEDIUM)
**Estimated Duration: 1 week**

통합 명령 팔레트와 키바인딩 시스템을 구현합니다.

| Task | Description | Complexity |
|------|-------------|------------|
| 4.1 | CommandProvider context | Medium |
| 4.2 | Dynamic command registration | Medium |
| 4.3 | useFilteredList hook | High |
| 4.4 | Fuzzy search algorithm | Medium |
| 4.5 | Keyboard navigation | Medium |

**Key Files to Create/Modify:**
```
src/tui/
├── context/
│   └── command.tsx          # NEW: Central command provider
├── hooks/
│   └── useFilteredList.ts   # NEW: Generic list navigation
├── component/
│   ├── dialog-command.tsx   # MODIFY: Use command context
│   └── CommandPalette.tsx   # MODIFY: Dynamic registration
└── ui/
    └── List.tsx             # NEW: Reusable list component
```

**Reference Implementation:**
- `opencode/packages/ui/src/hooks/use-filtered-list.tsx`
- `opencode/packages/app/src/context/command.tsx`

---

### Phase 5: TUI Component Parity (Priority: MEDIUM)
**Estimated Duration: 1.5 weeks**

TUI 컴포넌트를 OpenCode 수준으로 개선합니다.

| Task | Description | Complexity |
|------|-------------|------------|
| 5.1 | Extmark/Pill rendering | High |
| 5.2 | Advanced prompt input | High |
| 5.3 | Stash/draft system | Medium |
| 5.4 | Session timeline dialog | Medium |
| 5.5 | Subagent dialog | Medium |
| 5.6 | Enhanced autocomplete | Medium |

**Key Files to Create/Modify:**
```
src/tui/
├── component/prompt/
│   ├── AdvancedPrompt.tsx   # MODIFY: Extmark support
│   ├── Extmark.tsx          # NEW: Virtual text rendering
│   ├── Stash.tsx            # NEW: Draft management
│   └── History.tsx          # NEW: Prompt history
├── component/
│   ├── dialog-timeline.tsx  # NEW: Session timeline
│   ├── dialog-stash.tsx     # NEW: Stash list dialog
│   └── dialog-subagent.tsx  # NEW: Subagent status
└── context/
    └── stash.tsx            # NEW: Stash state management
```

**Reference Implementation:**
- `opencode/packages/opencode/src/cli/cmd/tui/component/prompt/index.tsx`
- `opencode/packages/opencode/src/cli/cmd/tui/component/prompt/stash.tsx`

---

### Phase 6: Web Console UI (Priority: HIGH)
**Estimated Duration: 2 weeks**

완전한 웹 콘솔 채팅 인터페이스를 구현합니다.

| Task | Description | Complexity |
|------|-------------|------------|
| 6.1 | Chat interface layout | High |
| 6.2 | PromptInput component | High |
| 6.3 | Message display | High |
| 6.4 | File tree sidebar | Medium |
| 6.5 | Terminal integration | High |
| 6.6 | Session management | Medium |
| 6.7 | Model/Agent selectors | Medium |

**Key Files to Create/Modify:**
```
packages/console/app/src/
├── pages/
│   ├── session.tsx          # NEW: Chat session page
│   ├── layout.tsx           # NEW: App layout with sidebar
│   └── home.tsx             # NEW: Session list/home
├── components/
│   ├── prompt-input.tsx     # NEW: Main input component
│   ├── message-part.tsx     # NEW: AI response rendering
│   ├── file-tree.tsx        # NEW: Project file browser
│   ├── terminal.tsx         # NEW: xterm.js integration
│   ├── session-header.tsx   # NEW: Session controls
│   └── sidebar.tsx          # NEW: Navigation sidebar
├── context/
│   ├── sdk.tsx              # NEW: SDK provider
│   ├── sync.tsx             # NEW: Real-time sync
│   ├── command.tsx          # NEW: Command provider
│   ├── prompt.tsx           # NEW: Prompt state
│   └── file.tsx             # NEW: File state
└── hooks/
    └── use-providers.ts     # NEW: Provider list hook
```

**Reference Implementation:**
- `opencode/packages/app/src/pages/session.tsx`
- `opencode/packages/app/src/components/prompt-input.tsx`

---

### Phase 7: Implementation Roadmap (Priority: HIGH)
**See: 07-IMPLEMENTATION-ROADMAP.md**

모든 작업의 우선순위와 의존성을 정리한 상세 로드맵입니다.

---

## Success Criteria

### Functional Requirements

| ID | Requirement | Acceptance Criteria |
|----|-------------|---------------------|
| F1 | Slash commands | Server-side execution with MCP support |
| F2 | File handling | Image/PDF paste and drag-drop work |
| F3 | Keyboard | Leader key sequences function correctly |
| F4 | Mouse | Copy-on-select copies to clipboard |
| F5 | Command palette | Dynamic registration and fuzzy search |
| F6 | TUI parity | All OpenCode TUI features available |
| F7 | Web console | Full chat interface functional |

### Non-Functional Requirements

| ID | Requirement | Target |
|----|-------------|--------|
| NF1 | Input latency | < 50ms response time |
| NF2 | Build time | < 30s for incremental builds |
| NF3 | Type safety | Zero TypeScript errors |
| NF4 | Test coverage | Maintain existing test pass rate |

---

## Risk Assessment

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| React vs SolidJS patterns | Medium | High | Adapt patterns, don't direct port |
| Ink limitations vs @opentui | High | Medium | Accept feature subset, document gaps |
| Breaking existing TUI | High | Medium | Feature flags, gradual rollout |
| Web console complexity | High | High | Prioritize MVP, iterate |

---

## Related Documents

1. [01-SLASH-COMMAND-IMPROVEMENTS.md](./01-SLASH-COMMAND-IMPROVEMENTS.md)
2. [02-FILE-HANDLING-SYSTEM.md](./02-FILE-HANDLING-SYSTEM.md)
3. [03-MOUSE-KEYBOARD-INTERACTIONS.md](./03-MOUSE-KEYBOARD-INTERACTIONS.md)
4. [04-COMMAND-PALETTE-KEYBINDINGS.md](./04-COMMAND-PALETTE-KEYBINDINGS.md)
5. [05-TUI-COMPONENT-PARITY.md](./05-TUI-COMPONENT-PARITY.md)
6. [06-WEB-CONSOLE-UI.md](./06-WEB-CONSOLE-UI.md)
7. [07-IMPLEMENTATION-ROADMAP.md](./07-IMPLEMENTATION-ROADMAP.md)

---

## Appendix: Analysis Sources

### Explore Agent Results

| Agent Task | Duration | Key Findings |
|------------|----------|--------------|
| SuperCode UI components | 25s | TUI has good foundation, gaps in advanced features |
| OpenCode UI components | 30s | Rich SolidJS-based UI with extmarks system |
| Slash commands | 67s | SuperCode client-only, OpenCode server+MCP |
| File handling | 55s | SuperCode text-only, OpenCode binary+preview |
| Mouse/keyboard | 44s | SuperCode has raw protocols, lacks leader keys |
| TUI components | 48s | Different paradigms (React vs Solid) |
| Existing docs | 27s | Good planning exists, needs UI-specific focus |

### Key OpenCode Reference Files

```
opencode/packages/
├── app/src/
│   ├── components/prompt-input.tsx    # 1500+ lines, rich input
│   ├── context/command.tsx            # Command registration
│   └── context/file.tsx               # File state management
├── opencode/src/cli/cmd/tui/
│   ├── component/prompt/index.tsx     # 1087 lines, TUI prompt
│   ├── component/dialog-command.tsx   # Dynamic palette
│   ├── context/keybind.tsx            # Leader key system
│   └── ui/dialog.tsx                  # Unified dialog
└── ui/src/hooks/
    └── use-filtered-list.tsx          # Generic list navigation
```

---

**Last Updated**: 2026-01-14
**Generated By**: Sisyphus Multi-Agent Analysis
